\chapter{Modular Arithmetic}

\begin{goals} 
	\begin{goal}{Lecture}
		\item Introduce counting ``on a dial''
		\item Extend to arithemetic.
		\item Introduce the idea of an \emph{equivalence relation} via modular equivalence.
		\item Introduce the extended Euclidean algorithm.
	\end{goal}
	
	\begin{goal}{Study}
		\item Learn to calculate within a modulus.
		\item Learn to use the extended Euclidean algorithm to determine multipicative inverses.
	\end{goal}
\end{goals}

The positions on a dial such as a clock have some of the features of a number system. There is a ``top of the dial''. Each position has a next position (clock-wise) and a previous position (counter-clockwise). As it happens, arithmetic on a dial, which mathematicians call \emph{modular arithmetic}, is fundamental to how we actually write numbers, for example as base 10 numerals, and how we perform arithmetic on those numerals. Cryptography is also an important area of application.  
 
Recall that the postulates of the natural numbers included the requirement that $0$ does not have  a predecessor (Postulate \ref{lec:NaturalNumbers}.\ref{post:NatZero}).  Exercise \ref{lec:NaturalNumbers}.\ref{exer:CyclicModel} asked you to draw depictions in which Postulate \ref{lec:NaturalNumbers}.\ref{post:NatZero} is relaxed. 
Assuming your response to Exercise \ref{lec:NaturalNumbers}.\ref{exer:CyclicModel} is correct, you may have drawn something similar to the dial-like structures in Figure \ref{fig:ModCycles}.

In the integers, $0$ (as well as all other integers) has a precedessor. Suppose we \emph{replace} Postulate \ref{lec:NaturalNumbers}.\ref{post:NatZero} with the requirement that every value has a predecessor. 
Then the integers satisfy all postulates, including the requirement that nothing can be removed. But it is also true that the cyclical pictures of Figure \ref{fig:ModCycles} do the job. 

For now, in order to avoid confusing pictures like this with the natural numbers, let us use alternative notation for ``the start'' and ``successor'', which we have been denoting as $0$ and $n^\nxt$ in the natural numbers.
For structures like those in \ref{fig:ModCycles}, let us write $\dialtop$ for the ``top of the dial'' and $\nx(a)$ for the ``next'' value after $a$ in the clock-wise direction. So we are now considering structures of the following sort.

\begin{defn}
	A \newterm{dial} is a structure satisfying the following conditions.
\begin{enumerate}
	\item There is a value $\dialtop$ and every value $a$ has a successor $\nx(a)$.
	\item Every value has a predecessor: for every $b$, there is an $a$ so that $\nx(a) = b$.
	\item Predecessors are unique: $\nx(a) = \nx(b)$ implies $a=b$.
	\item No values can be removed without violating 1 and 2.
\end{enumerate}

For our purposes, we may refer to the values of a dial as \newterm{positions}. So think of $\dialtop$ as the name for the \emph{top the dial}; think of $\nx(a)$ as the next position \emph{clock-wise from $a$}. 
\end{defn}

\begin{example}
The integers form a dial by letting $\dialtop={}^+0$ and $\nx(a)=a+1$.
Every integer has a successor. Every integer has a unique predecessor. Moreover, if we were to remove any integers, then eith er we would remove $0$, or some other remaining integer would either not have a successor or not have a predecessor.

Any actual cyclic structure like those in Figure \ref{fig:ModCycles} is a dial.

Consider a disc with labels ``$A$'' through ``$Z$'' printed evenly spaced on its edge. Then the label clockwise after ``$Z$'' is ``$A$''. So letting $\dialtop = A$, this is a physical model of finite dial.
\end{example}  

Almost the same definitions for addition and multiplication work in dial as they did in the natural numbers:

\begin{defn}[Addition on a Dial]
	Suppose $\DD$ is a dial (it satisfies the four postulates above). For any $a$ in $\DD$ and any natural number $n$, the \newterm{sum} $a+_\DD n$ is given by the equations:
	\begin{align*}
		a +_\DD 0 &= a\\
		a +_\DD k^\nxt &= \nx(a+_\DD k)
	\end{align*}
\end{defn}

This definition extends to all integers.

\begin{lem}
	Let $\DD$ be a dial.
	For any natural number $n$, there is a position $a$ on the dial so that $a+_\DD n = \dialtop$.
	
	\begin{proof}
		First, we proof that $\nx(a +_\DD n) = \nx(a) +_\DD n$ for all $a$ by induction on $n$. The basis is obvious from the definition of $+_\DD$. Assume that $\nx(b +_\DD k) = \nx(b) +_\DD k$ for all $b$. Then 
		\begin{align*}
		\nx(a +_\DD k^\nxt) &= \nx(\nx(a+_\DD k))\\
		                    &= \nx(\nx(a) +_\DD k)\\
		                    &= \nx(a) +_\DD k^\nxt.
		\end{align*}
		
		Now we proof the lemma by induction on $n$,
		\begin{itemize}
			\item{}[Basis] $\dialtop +_\DD 0 = \dialtop$. If $a +_\DD 0 = \dialtop$, then obviously $a=\dialtop$.
			\item{}[Inductive Hypothesis] Assume that there is a unique $b$ so that $b +_\DD k = \dialtop$.
			\item{}[Inductive Step] Let $a$ be the unique predecessor of the position $b$ given by the inductive hypothesis. Then $\nx(a)=b$. Hence $a +_\DD k^\nxt = = \nx(a) +_\DD k = \dialtop$. 
		\end{itemize}
	\end{proof}
\end{lem}


\begin{lem}\label{lem:modular-addition}
	Let $\DD$ be a dial.
	For any $a$ in $\DD$ and any natural numbers $n$ and $p$, $a +_\DD (n+p) = (a +_\DD n) +_\DD p$.
	
	\begin{proof}
		Exercise
%		The proof is by induction on $p$. 
%		\begin{itemize}
%			\item{}[Basis] $a +_\DD (n+0) = a +_\DD n = (a +_\DD n) +_\DD 0$.
%			\item{}[Inductive Hypothesis] Assume that $a +_\DD (n+k) = (a +_\DD n) +_\DD k$ for some $k$.
%			\item{}[Inductive Step] 
%			\begin{align*}
%				a +_\DD (n+k^\nxt) &= a +_\DD (n+k)^\nxt\\ 
%				                 &= \nx(a +_\DD (n+k))\\
%				                 &= \nx((a +_\DD n) +_\DD k)\\
%				                 &= (a +_\DD n) +_\DD k^\nxt.
%			\end{align*}
%		\end{itemize}
	\end{proof}
\end{lem}

So now we can define $a -_\DD n$ as the unique element so that $(a -_\DD n) +_\DD n = \dialtop$. So every integer $i$ determines an element $\dialtop +_\DD i$. 

The elements on a dial that can be written as $\dialtop +_\DD i$ for some integer $i$ evidently satisfy the conditions 1. and 2 in the definition of dials, so according to condition 4, they constitute all elements of the dial.   
In other words, when we wish to consider a general position $a$ on a dial, we may say ``pick an integer $i$ so that $a = \dialtop +_\DD i$. This $i$ may not be unique, but it exists.

\begin{exer}
	\begin{exercise}
		\item Prove Lemma \ref{lem:modular-addition}.
	\end{exercise}
\end{exer}

Now that we know we can describe any position as $\dialtop +_\DD i$, we are tempted to define addition of positions: $a +_\DD b$ by saying ``pick some $i$ so that $b = \dialtop +_m i$. Then define $a+_\DD b$ to be equal to $a +_m i$.'' That, however, is \emph{not} a definition unless we can show that the result does not depend on which $i$ we pick. In other words, we need to show that if $b=\dialtop +_m i = \dialtop +_m j$, then $a +_\DD i = a +_\DD j$.

\begin{lem}
	On any dial $\DD$, for any positions $a$ and $b$ and any integers $i$ and $j$, if $b +_\DD i = b +_\DD j$, then $a +_\DD i = a +_\DD j$.
	\begin{proof} 
Suppose $b +_\DD i = b +_\DD j$.
Pick an integers $k$ and $h$ so that $a = \dialtop +_\DD k$ and $b = \dialtop +_\DD h$. Thus $a+_\DD i = \dialtop +_\DD(k-h+h + i) = (b +_\DD i) +_\DD (k-h)$. Likewise $a+_\DD j = (b +_\DD j) +_\DD(k-h)$. So the two are equal.
\end{proof}
\end{lem}

This justifies writing $a +_\DD b$ for adding positions on the dial. Namely, we can pick any $i$ so that $b = \dialtop +_\DD i$ and define $a +_\DD b$ to be equal to $a +_\DD i$. 

\begin{exer}
	Fix a dial $\DD$. [All of these are easy exercises. Do not over think them.]
	\begin{exercise}
		\item Show that addition of positions is associative.
		\item Show that addition of positions is commutative.
		\item Show that $\dialtop$ is an additive identity.
		\item Show that every position has a unique additive inverse. That is, for any $a$ there is exactly one position ${}^-a$ so that $a +_\DD {}^-a = \dialtop$. [Hint: if $a = \dialtop +_\DD i$, then let ${}^-a = \dialtop +_\DD(-i)$. Now show that if $a +_\DD b = \dialtop$, then $b = {}^-a$.]
	\end{exercise}
\end{exer}

We may now also define multiplication in a dial.

\begin{defn}
	For position $a$ of a dial $\DD$ and integer $i$, define $a\cdot_\DD i$ by the equations
	\begin{align*}
		a\cdot_\DD  0 &= \dialtop\\
		a\cdot_\DD j^\nxt &= a +_\DD (a\cdot_\DD j)
	\end{align*}
	
	This defines addition of natural numbers in the usual way, but it also extends uniquely to negative integers. For example, $a \cdot_\DD {}^-1$ must satisfy the equation $a\cdot_\DD {}^-1^\nxt = a +_\DD a\cdot {}^-1$.
	Therefore, $\dialtop = a +_\DD a\cdot {}^-1$. So $a\cdot_\DD {}^-1 = {}^- a$.
\end{defn}


\begin{lem}\label{lem:modular-mult}
	Fix a dial $\DD$. For any position $a$ and integers $i$ and $j$, it is the case that 
	\begin{align*} 
		(a \cdot_\DD i)+_\DD (a\cdot_\DD j) &= a\cdot_\DD (i+j)\\
		(a\cdot_\DD i)\cdot_\DD j &= a\cdot_\DD (i\cdot j)\\
		(a\cdot_\DD i) +_\DD (b\cdot_\DD i) &= (a+_\DD b)\cdot_\DD i\\
		a\cdot_\DD{}^-i &= {}^-a \cdot_\DD i
	\end{align*}

\begin{proof}
	Exercise.
\end{proof}
\end{lem}

These results tell us that multiplication of a dial position by an integer``behaves'' as we would expect it to. Thus we can also make sense of multiplying two positions: $a \cdot_\DD b$ is defined by picking some $i$ so that $b = \dialtop +_\DD i$ and letting $a\cdot_\DD b = a\cdot_\DD i$. As with addition, this is meaningful only if the result does not depend on the choice of $i$. That is, we need to show that if $\dialtop +_\DD i = \dialtop +_\DD j$, then $a\cdot_\DD i = a\cdot_\DD j$. We leave that as an unassigned exercise.

\begin{exer}
	\begin{exercise}
		\item Prove Lemma \ref{lem:modular-mult}.
		\item Refer to the Arithmetic Laws in Lecture \ref{lec:ArithmeticLaws}. For each law, determine whether or not the same law holds for arithmetic on all dials.
	\end{exercise}
\end{exer}


\section*{Moduli}

The cyclical dials (see Figure \ref{fig:ModularCycles}) differ from the dial consisting of all integers, for in a cyclical dial $\dialtop = \dialtop +_\DD k$ for some positive integer $k$. We refer to the smallest positive integer $m$ satisfying $\dialtop = \dialtop +_\DD m$ as the \newterm{modulus} of $\DD$. In that case, we write $\ZZ_m$ instead of $\DD$. If no modulus exists for a dial, then it is a model of the integers. In that case, we write $\ZZ$. 
Thus for example, $\ZZ_{12}$ models a standard twelve hour clock. $\ZZ_{10}$ models a dial with labels $0$ through $9$, $\ZZ_{26}$ models a dial with the letters of the alphabet. An important example is $\ZZ_2$. This is a dial with exactly two labels, say one at the top and one at the bottom. We might as well think of this as a switch with on and off positions. $\ZZ_1$ is a trivial dial with only one position.

For a dial $\ZZ_m$, we will write $a +_m b$ instead of $a +_{\ZZ_m} b$. Remember though that $i+j$ means ``honest'' integer arithmetic. Now $a +_m b$ means arithmetic in the dial $\ZZ_m$: $(\dialtop +_m i)+_m(\dialtop +_m j)$. 

\begin{defn}[Modular Equivalence]\label{def:modulus}
	Fix a modulus $m>0$. Two integers $i$ and $j$ are \emph{equivalent modulo $m$} if it is the case that $\dialtop +_m i = \dialtop +_m j$. In that case, we write $i\equiv j\mod m$. 
\end{defn}

Recall that for any positive $m$ and any integer $i$, there is a unique pair of integers $(q,r)$ so that $i = qm + r$ and $0\leq r < m$. We used the notation $i\ddiv m$ and $i\drem m$ to denote these. It is easy to see that
$i \equiv j \mod m$ if and only if $(i\drem m)=(j\drem m)$ if and only if $m\mid (i-j)$.

The lemmas of the previous section show that integer arithmetic is compatible with modular equivalence in the sense that if $a_0\equiv a_1\mod m$ then $a_0 + b \equiv a_1 + b\mod m$ and $a_0b\equiv a_1b\mod m$. This means we can safely perform arithmetic in the familiar way and maintain equivalence modulus $m$. 

\begin{exer}
	For each of the following, find an integer $x$ making the statement true, or show that no such $x$ exists.
	\begin{exercise}
		\item $5 + x \equiv 3 \mod 7$
		\item $x\cdot 5\equiv 1 \mod 11$
		\item $3 + 4x \equiv 2\mod 9$
		\item $x\cdot 4 \equiv 1\mod 12$
		\item $4 \equiv 7 \mod x$
		\item $x\equiv 2\mod 7$ and $x\equiv 3\mod 5$
	\end{exercise}
\end{exer}

Two integers $a$ and $b$ act as reciprocals if $a \cdot_\DD b\equiv 1\mod m$.
In rational numbers $q\cdot \frac1q = 1$ for any non-zero rational $q$. So $a\cdot b\equiv 1\mod m$ is analogous. For example, $7\cdot 13 \equiv 1\mod 15$. But $5\cdot x \equiv 1\mod 15$ can not be solved for $x$. We need a criterion for determining when an integer $a$ has a reciprocal modulo $m$. Even better, a method for determining reciprocals when they exist would allow us to make modular arithmetic effective. 

\begin{lem}[Extended Euclid's Algorithm]
	For any two integers $a$ and $b$, there exist integers $s$ and $t$ so that $\gcd(a,b)=as+bt$.
	
	\begin{proof}
		The proof is by strong induction on $a$. 
		Suppose $a=0$.
		Then let $s=0$ and $t=1$. Otherwise, we know that $\gcd(a,b)=\gcd(b\drem a, a)$. By the inductive hypothesis, there are integers $s'$ and $t'$
		so that $\gcd(b\drem a, a)= (b\drem a)s'+at'$. But also $b = a\cdot(b\ddiv a)+(b\drem a)$.
		So $\gcd(a,b) = (b-a\cdot(b\ddiv a))\cdot s' + at'= a(t'-(b\ddiv a)s') + bs'$. Thus we let $s=t'-(b\ddiv a)s'$ and $t=s'$.
	\end{proof}
\end{lem}



\begin{thm}
	For integer $a\neq 0$ and positive integer $m$, there is an integer $x$ so that $x\cdot a\equiv 1\mod m$ if and only if $\gcd(a,m)=1$.
	
	\begin{proof}
		According to the previous lemma there are integers $s$ and $t$ so that $as+mt = \gcd(a,m)$. Thus $as\drem m = \gcd(a,m)$.
		If $\gcd(a,m)=1$, then $s$ is the desired value for $x$.
		Conversely, suppose $ab\equiv 1\mod m$ is true for some $b$. Then
		$ab\drem m = 1$. So there is some $c$ for which $ab + mc = 1$.
		Now suppose $d$ is a positive common divisor of $a$ and $m$. That is, $d>0$ and
		$a = de$ and $m = df$ for some $e$ and $f$. Then $deb + dfc = 1$. So
		$d(eb + cf) = 1$. But this can only happen when $d=1$. Hence $\gcd(a,m)=1$.
	\end{proof}
\end{thm}

This shows that if a modulus $m$ is a prime number, then all integers have reciprocals modulo $m$. It also shows that any odd number has a reciprocal modulo any $m$ that is a power of $2$. 